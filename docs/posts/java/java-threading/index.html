<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">

    <meta name="author" content="Akhilesh Dhar Dubey">
    <meta name="description" content="Thread:   Thread can be created by new Thread() only.
  Each object in Java is associated with a monitor, which a thread can lock or unlock. Only one thread at a time may hold a lock on a monitor. Any other threads attempting to lock that monitor are blocked until they can obtain a lock on that monitor.
   If execution of the body is ever completed, either normally or abruptly, an unlock action is automatically performed on that same monitor.">
    <meta name="keywords" content="java, blog, deep learning">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Threading"/>
<meta name="twitter:description" content="Thread:   Thread can be created by new Thread() only.
  Each object in Java is associated with a monitor, which a thread can lock or unlock. Only one thread at a time may hold a lock on a monitor. Any other threads attempting to lock that monitor are blocked until they can obtain a lock on that monitor.
   If execution of the body is ever completed, either normally or abruptly, an unlock action is automatically performed on that same monitor."/>

    <meta property="og:title" content="Threading" />
<meta property="og:description" content="Thread:   Thread can be created by new Thread() only.
  Each object in Java is associated with a monitor, which a thread can lock or unlock. Only one thread at a time may hold a lock on a monitor. Any other threads attempting to lock that monitor are blocked until they can obtain a lock on that monitor.
   If execution of the body is ever completed, either normally or abruptly, an unlock action is automatically performed on that same monitor." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://akhilesh006.github.io/javaprincipal/posts/java/java-threading/" />
<meta property="article:published_time" content="2020-06-02T08:17:23+05:30" />
<meta property="article:modified_time" content="2020-06-02T08:17:23+05:30" />


    
      <base href="https://akhilesh006.github.io/javaprincipal/posts/java/java-threading/">
    
    <title>
  Threading · Java Principal
</title>

    
      <link rel="canonical" href="https://akhilesh006.github.io/javaprincipal/posts/java/java-threading/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css" integrity="sha384-Bfad6CLCknfcloXFOyFnlgtENryhrpZCe29RTifKEixXQZ38WheV+i/6YWSzkz3V" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="https://akhilesh006.github.io/javaprincipal/css/coder.min.a4f332213a21ce8eb521670c614470c58923aaaf385e2a73982c31dd7642decb.css" integrity="sha256-pPMyITohzo61IWcMYURwxYkjqq84XipzmCwx3XZC3ss=" crossorigin="anonymous" media="screen" />
    

    

    

    

    

    <link rel="icon" type="image/png" href="https://akhilesh006.github.io/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://akhilesh006.github.io/images/favicon-16x16.png" sizes="16x16">

    <meta name="generator" content="Hugo 0.71.1" />
  </head>

  
  
  <body class="colorscheme-light">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://akhilesh006.github.io/javaprincipal/">
      Java Principal
    </a>
    
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://akhilesh006.github.io/javaprincipal/about/">About</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://akhilesh006.github.io/javaprincipal/posts/">Blog</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://github.com/onslabs">Projects</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://akhilesh006.github.io/javaprincipal/contact/">Contact me</a>
          </li>
        
      
      
    </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">Threading</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2020-06-02T08:17:23&#43;05:30'>
                June 2, 2020
              </time>
            </span>
            
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              3-minute read
            </span>
          </div>
          
          
        </div>
      </header>

      <div>
        
        <h2 id="thread">Thread:</h2>
<ul>
<li>
<p>Thread can be created by new Thread() only.</p>
</li>
<li>
<p>Each object in Java is associated with a monitor, which a thread can lock or unlock. Only one thread at
a time may hold a lock on a monitor. Any other threads attempting to lock that
monitor are blocked until they can obtain a lock on that monitor.</p>
</li>
</ul>
<p><img src="https://akhilesh006.github.io/javaprincipal/threading.png" alt="Thread"></p>
<ul>
<li>If execution of the body is ever completed, either normally or abruptly, an unlock action is
automatically performed on that same monitor.</li>
<li>If the method is an instance method, it locks the monitor associated with the instance
for which it was invoked. 
If the method is static, it locks the monitor associated with the Class object that represents the class in which the method is
defined.</li>
</ul>
<h2 id="synchronization">Synchronization:</h2>
<p>Synchronize can be achieved by</p>
<ol>
<li>synchronized(object){} block</li>
<li>synchronized method</li>
<li>volatile keyword</li>
<li>using class of java.util.concurrent package.</li>
<li>Collections.synchronizedList, synchronizedSet, synchronizedMap</li>
<li>Collection&rsquo;s Legacy class: Vector, Stack(subclass of Vector) HashTable, Properties( subclass of HashTable)</li>
</ol>
<p>Note: Use ArrayDeque instead of Stack when synchronization isn&rsquo;t needed.</p>
<h5 id="javalangillegalmonitorstateexception">java.lang.IllegalMonitorStateException</h5>
<ol>
<li>If wait(), notify() or notifyAll() are not used inside synchronized block or synchronized method.</li>
<li>If wait(), notify() or notifyAll() are called on other object.</li>
</ol>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    Object sync = <span style="color:#fff;font-weight:bold">new</span> Object();
    <span style="color:#fff;font-weight:bold">synchronized</span> (<span style="color:#fff;font-weight:bold">this</span>) {
        sync.<span style="color:#007f7f">wait</span>(100);
    } 
</code></pre></div><ul>
<li>notify() does not guarantee which thread will be removed from wait set.</li>
</ul>
<h3 id="wait-sets">Wait Sets</h3>
<ul>
<li>A Wait Sets is a set of thread.</li>
<li>Each object have its own Wait set and Monitor.</li>
<li>When a object is created, Its wait set is empty.</li>
<li>Wait set are manipulated by Object.wait(), notify(), notifyAll() and reset when interrupted by a thread.</li>
<li>wait(0) = wait(0,0) = wait()</li>
<li>When a thread executing a wait() method of an object if, That thread is added into wait set of that object.
and perform n unlock action on that object. Now thread does not execute any instruction until it is removed from wait set of that object.</li>
<li>Thread can be removed from wait set by following action:
<ul>
<li>notify is called on that object.</li>
<li>notifyAll is called on that object.</li>
<li>An interrupt is performed on waiting thread.</li>
<li>Thread timeout, JVM internally remove the thread.</li>
</ul>
</li>
</ul>
<h5 id="q-what-happens-when-notify-in-interrupt-both-are-called-simultaneously">Q: What happens When notify() in interrupt() both are called simultaneously.</h5>
<p>A: If notify() executed first then thread will be successfully removed from the wait set and a interrupt call will be placed for other thread waiting on that object.
If interrupt() is executed first then thread will removed from wait set throwing InterruptedException, and wait() will be placed for other thread waiting on that object.</p>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">Thread.<span style="color:#007f7f">currentThread</span>(); <span style="color:#007f7f">//Return reference of current thread executing this line.
</span><span style="color:#007f7f"></span>Thread.<span style="color:#007f7f">sleep</span>(); <span style="color:#007f7f">// sleep and hold the lock.
</span><span style="color:#007f7f"></span>Thread.<span style="color:#007f7f">dumpStack</span>(); <span style="color:#007f7f">// Print stack trace, Used for debugging purpose.
</span><span style="color:#007f7f"></span>Thread.<span style="color:#007f7f">yield</span>(); <span style="color:#007f7f">// A hint to the scheduler that the current thread is willing to yield its current use of a processor. The scheduler is free to ignore this hint.
</span><span style="color:#007f7f"></span>
</code></pre></div><h5 id="173-the-compiler-is-not-forced-to-flush-write-from-cache-to-shared-memory-in-register-and-read-value-from-register">(§17.3) The compiler is not forced to flush write from cache to shared memory in register and read value from register.</h5>
<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#fff;font-weight:bold">while</span> (!<span style="color:#fff;font-weight:bold">this</span>.<span style="color:#007f7f">done</span>)
    Thread.<span style="color:#007f7f">sleep</span>(1000);
</code></pre></div><p>The compiler is free to read the field this.done just once, and reuse the cached value in
each execution of the loop. This would mean that the loop would never terminate, even if
another thread changed the value of this.done.</p>
<h4 id="data-race-1745-broken-code-improperly-synchronized">data race (§17.4.5) Broken code: improperly synchronized</h4>
<ul>
<li>there is a write in one thread,</li>
<li>a read of the same variable by another thread,</li>
<li>and the write and read are not ordered by synchronization.</li>
</ul>
<table>
<thead>
<tr>
<th align="center">Thread 1</th>
<th align="center">Thread 2</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">1. x = A</td>
<td align="center">3. y = B</td>
</tr>
<tr>
<td align="center">2. B = 1</td>
<td align="center">4. A = 2</td>
</tr>
</tbody>
</table>
<pre><code>          or 
</code></pre>
<table>
<thead>
<tr>
<th align="center">Thread 1</th>
<th align="center">Thread 2</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">1. B = 1</td>
<td align="center">3. y = B</td>
</tr>
<tr>
<td align="center">2. x = A</td>
<td align="center">4. A = 2</td>
</tr>
</tbody>
</table>

      </div>


      <footer>
        


        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "yourdiscussshortname" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        
        
      </footer>
    </article>

    
  </section>

      </div>

      
  <footer class="footer">
    <section class="container">
      
        <p>Those who don't remember the past are condemned to repeat it. - Dynamic Programming</p>
      
      
      
      
    </section>
  </footer>

    </main>

    

    

    <script>
(function(f, a, t, h, o, m){
	a[h]=a[h]||function(){
		(a[h].q=a[h].q||[]).push(arguments)
	};
	o=f.createElement('script'),
	m=f.getElementsByTagName('script')[0];
	o.async=1; o.src=t; o.id='fathom-script';
	m.parentNode.insertBefore(o,m)
})(document, window, '//analytics.example.com/tracker.js', 'fathom');
fathom('set', 'siteId', 'ABCDE');
fathom('trackPageview');
</script>


  </body>

</html>
